# Overview

This folder contains files and information around the Printed Circuit Board contained inside the Implantable Pulse Generator (IPG). This PCB was designed for CARSS by Medipace Inc. (https://www.medipaceinc.com/). Editable source files, generated using Altium, can be found in the Source Files folder.

# Design
The purpose of this PCBA is to regulate power, communication, neuromodulation, and biomarker sensing. Individual sections of the PCB are explained below.

## Power Regulation and Transmission
### Power and NFC data transmission
The IPG PCB receives power inductively through a coil resonating between 100 - 300 kHz. Load-Shift Keying (LSK) can be used to transmit data over this inductive link, by selectively de-tuning the load via transistors M501, M514, and M515. Amplitude shift keyed signals can also be received by this PCB by sampling the rectified signal. After rectifying and protecting against overvoltage the inductively transmitted power signal is converted to a battery charging voltage VCHRG_RAIL at 5V and up to 600mA by a LTC3130IUDC-1 buck-boost converter (U503).

### Battery charging
The 5V generated by U503 feeds into two LTC4065LEDC battery charging ICs (U2 and U4) which can be programmed to one of four charging currents using signals CHG_RATE1 and CHG_RATE2 from the MCU. Each of the two cells has its own independent charging circuit and overvoltage  protection circuit. However, the set charge rate applies to both cells simultaneously.

### Digital and analog voltage generation
The buffered battery voltages are used to generate three separate 3.3V rails using three independent AP7354D low dropout regulators. The digital supply, DVDD, supplies power to the MCU and BLE circuitry. The stimulation supply, VDDS, supplies voltage to low-voltage components in the stimulation and impedance sensing circuitry. The analog supply, VDDA, supplies voltage to the ECG and EGG circuits.

### Thermistor interface
Buffer circuitry is included for using a thermistor to monitor the temperature of the PCB during use.

### Magnet Sensor
A magnetic sensor BD020 (U8) and supporting circutry disconnects the battery from the supply voltage generating circuitry in the presence of a magnetic field. It should be noted that charging circuitry is still connected to the batteries when a magnetic field is present. However, as digital enable pins that affect charging rate will be in an undetermined state, and no thermal monitoring circuitry will be available to check the temperature of the PCB or battery during charging, we do not recommend charging this board in the presence of a magnetic field.
[Speculation - ask Victor!]

## MCU

## Stimulation

## Impedance Sensing

## ECG and EGG Sensing

## Bluetooth Low Energy (BLE)



# Status and updates
## 29 June 2023
The first revision of the PCBA has been taped out and assembled; testing is expected to be finished by the end of 2023.
![Photograph of a test PCBA](/images/Test Board rev1.jpg)
